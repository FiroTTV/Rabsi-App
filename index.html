<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Rabsi â€“ Nail Streak ğŸ’…</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#7a5cff">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
html,body{
    margin:0;
    padding:0;
    font-family:system-ui,sans-serif;
    min-height:100vh;
}
body{
    background:linear-gradient(135deg,#ffd6e8,#e6dbff);
    display:flex;
    justify-content:center;
    padding:24px 0;
}
body.dark{
    background:linear-gradient(135deg,#2b1d3a,#1e1e2f,#2a1f4f);
}
.hidden{display:none}

#stars{
    position:fixed;
    inset:0;
    pointer-events:none;
    opacity:0;
}
body.dark #stars{opacity:1}
.star{
    position:absolute;
    width:2px;height:2px;
    background:radial-gradient(circle,#fff,#c7b3ff);
    border-radius:50%;
    animation:floatStar linear infinite;
}
@keyframes floatStar{
    from{transform:translateY(0);opacity:.2}
    to{transform:translateY(-100vh);opacity:1}
}

.app{
    background:white;
    max-width:420px;
    width:100%;
    border-radius:24px;
    padding:24px;
    box-shadow:0 20px 40px rgba(0,0,0,.15);
}
body.dark .app{
    background:#1f1b2e;
    color:#fff;
}

h1{text-align:center;margin-bottom:8px}

button{
    width:100%;
    padding:12px;
    border-radius:14px;
    border:none;
    font-weight:600;
    margin-bottom:10px;
}
.buttons{display:flex;gap:10px}
.buttons button{width:50%}
.yes{background:#7be495}
.no{background:#ff8a8a}
button:disabled{opacity:.5}

.weekdays,.calendar{
    display:grid;
    grid-template-columns:repeat(7,1fr);
    gap:6px;
}
.weekdays{font-size:12px;opacity:.7;margin-bottom:6px;text-align:center}
.calendar{margin-bottom:16px}
.day{
    aspect-ratio:1/1;
    border-radius:12px;
    background:#eee;
    display:flex;
    justify-content:center;
    align-items:center;
}
body.dark .day{background:#333}
.success{background:#4cd964!important}
.fail{background:#ff5c5c!important}
.today{outline:3px solid #7a5cff}

.streak{
    text-align:center;
    background:#f6f6ff;
    padding:14px;
    border-radius:14px;
    margin-bottom:16px;
    font-weight:700;
}
body.dark .streak{background:#2a2a3d}

.gift{
    text-align:center;
    padding:14px;
    border-radius:14px;
    background:#f6f6ff;
}
body.dark .gift{background:#2a2a3d}
.locked{color:#888}
.unlocked{
    background:linear-gradient(135deg,gold,orange);
    font-weight:700;
}

.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.6);
    display:none;
    justify-content:center;
    align-items:center;
}
.modal-content{
    background:white;
    padding:20px;
    border-radius:20px;
    width:90%;
    max-width:400px;
}
body.dark .modal-content{
    background:#1c1c28;
    color:#fff;
}
</style>
</head>

<body>
<div id="stars"></div>

<!-- LOGIN -->
<div class="app" id="loginBox">
    <h1>ğŸ’œ Rabsi Login</h1>
    <input id="email" placeholder="E-Mail" style="width:100%;padding:12px;margin-bottom:10px">
    <input id="password" type="password" placeholder="Passwort" style="width:100%;padding:12px;margin-bottom:10px">
    <button onclick="login()">Einloggen / Registrieren</button>
</div>

<!-- APP -->
<div class="app hidden" id="appBox">
    <h1>ğŸ”¥ Rabsi's Nail-Streak</h1>

    <button onclick="openAccount()">âš™ï¸ Account</button>
    <button onclick="toggleDark()">ğŸŒ™ Dark Mode</button>

    <div class="streak" id="streakBox">ğŸ”¥ 0 Tage Streak</div>

    <div class="weekdays">
        <div>Mo</div><div>Di</div><div>Mi</div>
        <div>Do</div><div>Fr</div><div>Sa</div><div>So</div>
    </div>
    <div class="calendar" id="calendar"></div>

    <div class="buttons">
        <button class="yes" id="btnYes">Heute nicht gekaut</button>
        <button class="no" id="btnNo">Heute gekaut</button>
    </div>

    <div class="gift locked" id="giftBox"></div>
</div>

<!-- ACCOUNT -->
<div class="modal" id="accountModal">
    <div class="modal-content">
        <h2>âš™ï¸ Account</h2>
        <p><b>E-Mail:</b> <span id="accEmail"></span></p>
        <p><b>User-ID:</b><br><small id="accUid"></small></p>
        <p><b>Gespeicherte Tage:</b> <span id="accDays"></span></p>
        <p><b>Admin:</b> <span id="accAdmin"></span></p>

        <button onclick="toggleAdmin()">ğŸ‘‘ Admin umschalten</button>
        <button onclick="resetPassword()">ğŸ” Passwort zurÃ¼cksetzen</button>
        <button onclick="logout()">ğŸšª Logout</button>
        <button onclick="closeAccount()">SchlieÃŸen</button>
    </div>
</div>

<script>
/* Firebase */
firebase.initializeApp({
  apiKey: "AIzaSyBjc2ti7FM5hRIzMrMxOsLIA_K5ulBRP3w",
  authDomain: "rabsi-nail-streak.firebaseapp.com",
  projectId: "rabsi-nail-streak",
  appId: "1:261656631522:web:9b79c2cbc0e1e8790126bb"
});
const auth=firebase.auth();
const db=firebase.firestore();

/* Stars */
for(let i=0;i<40;i++){
 const s=document.createElement("div");
 s.className="star";
 s.style.left=Math.random()*100+"vw";
 s.style.top=Math.random()*100+"vh";
 s.style.animationDuration=20+Math.random()*20+"s";
 stars.appendChild(s);
}

/* State */
let data={};
let isAdmin=localStorage.getItem("rabsiAdmin")==="1";
const today=new Date();
const year=today.getFullYear();
const month=today.getMonth();
const daysInMonth=new Date(year,month+1,0).getDate();

/* Helpers */
function keyFor(d){
 return `${year}-${String(month+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
}

/* Auth */
auth.onAuthStateChanged(user=>{
 if(!user){
  loginBox.classList.remove("hidden");
  appBox.classList.add("hidden");
  return;
 }
 loginBox.classList.add("hidden");
 appBox.classList.remove("hidden");

 accEmail.textContent=user.email;
 accUid.textContent=user.uid;

 db.collection("users").doc(user.uid).onSnapshot(doc=>{
  data=doc.data()?.streakData||{};
  accDays.textContent=Object.keys(data).length;
  accAdmin.textContent=isAdmin?"AN":"AUS";
  render();
 });
});

/* Render */
function render(){
 calendar.innerHTML="";
 let streak=0;

 for(let d=1;d<=daysInMonth;d++){
  const el=document.createElement("div");
  el.className="day";
  el.textContent=d;
  if(data[keyFor(d)]==="success") el.classList.add("success");
  if(data[keyFor(d)]==="fail") el.classList.add("fail");
  if(d===today.getDate()) el.classList.add("today");
  calendar.appendChild(el);
 }

 for(let d=today.getDate();d>=1;d--){
  if(data[keyFor(d)]==="success") streak++;
  else break;
 }
 streakBox.textContent=`ğŸ”¥ ${streak} Tage Streak`;

 checkGift();
 applyTimeLock();
}

/* Gift */
function checkGift(){
 for(let d=1;d<=daysInMonth;d++){
  if(data[keyFor(d)]!=="success"){
   giftBox.className="gift locked";
   giftBox.innerHTML="ğŸ”’ Geschenk gesperrt";
   return;
  }
 }
 giftBox.className="gift unlocked";
 giftBox.innerHTML="ğŸ Geschenk freigeschaltet ğŸ‰<br><br>Rabsi, ich bin stolz auf dich ğŸ’–";
}

/* Save */
function save(res){
 const k=keyFor(today.getDate());
 if(data[k])return;
 if(today.getHours()<20 && !isAdmin)return;
 data[k]=res;
 db.collection("users").doc(auth.currentUser.uid).set({streakData:data},{merge:true});
}
btnYes.onclick=()=>save("success");
btnNo.onclick=()=>save("fail");

/* Time lock */
function applyTimeLock(){
 const locked=today.getHours()<20&&!isAdmin;
 btnYes.disabled=locked;
 btnNo.disabled=locked;
}

/* Account */
function openAccount(){accountModal.style.display="flex"}
function closeAccount(){accountModal.style.display="none"}
function toggleAdmin(){
 isAdmin=!isAdmin;
 localStorage.setItem("rabsiAdmin",isAdmin?"1":"0");
 accAdmin.textContent=isAdmin?"AN":"AUS";
 applyTimeLock();
}
function resetPassword(){
 auth.sendPasswordResetEmail(auth.currentUser.email);
 alert("E-Mail zum ZurÃ¼cksetzen gesendet");
}

/* Login */
function login(){
 auth.signInWithEmailAndPassword(email.value,password.value)
 .catch(()=>auth.createUserWithEmailAndPassword(email.value,password.value));
}
function logout(){auth.signOut()}

/* Dark */
function toggleDark(){
 document.body.classList.toggle("dark");
}
</script>
</body>
</html>
